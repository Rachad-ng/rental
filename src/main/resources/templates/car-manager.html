<!DOCTYPE html>
<html lang="en"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="Layout">

    <head>
        <meta th:name="${_csrf.parameterName}" th:content="${_csrf.token}"/>
        <title>Gestion de voiture</title>
        <link rel="stylesheet" th:href="@{/style/modal-cost.css}">

        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
        <script th:src="@{/script/modal-cost.js}"></script>
        <script th:src="@{/script/moment-with-locales.js}" ></script>
    </head>

    <body>

        <!-- Dynamic Content Section Start -->
        <section layout:fragment="content" th:object="${carDetailsDto}">

            <!--Listing details Top Start-->
            <section class="listing-details-top">
                <div class="container">
                    <ul class="list-unstyled listing-details-top__menu">
                        <li><a th:href="@{/}">Accueil</a></li>
                        <li><span>-</span></li>
                        <li><a th:href="@{/listings}">Offres</a></li>
                        <li><span>-</span></li>
                        <li class="active"><a href="#" th:text="*{model.mark.libelle + ' ' + model.libelle}"></a></li>
                    </ul>
                </div>
            </section>
            <!--Listing details Top End-->

            <!--Listing Details Start-->
            <section class="listing-details">
                <div class="container">
                    <div class="row">

                        <!-- Listing details left block Start -->
                        <div class="col-xl-8 col-lg-7">
                            <div class="listing-details__left">

                                <!-- Block images Start -->
                                <div class="listing-details__gallery clearfix">
                                    <div class="listing-details__gallery-content-box">
                                        <ul class="bxslider list-unstyled clearfix">
                                            <li>
                                                <div class="listing-details__gallery-sliding-img">
                                                    <img th:src="@{'/assets/images/resources/cars/standard/' + *{model.image} + '.jpg'}"
                                                         th:alt="${'Rental car ' + carDetailsDto.model.mark.libelle + ' ' + carDetailsDto.model.libelle}">
                                                </div>
                                            </li>
                                        </ul>
                                    </div>
                                </div>
                                <!-- Block images End -->

                                <!-- Car additional feautures start -->
                                <div class="listing-details__features">
                                    <div class="row">
                                        <div class="col-xl-4 col-lg-4 col-md-4">
                                            <ul class="list-unstyled listing-details__features-list">
                                                <li th:if="*{airConditioning}">
                                                    <div class="icon">
                                                        <i class="fa fa-check"></i>
                                                    </div>
                                                    <div class="text">
                                                        <p>Climatisation</p>
                                                    </div>
                                                </li>
                                                <li th:if="*{androidAvailable}">
                                                    <div class="icon">
                                                        <i class="fa fa-check"></i>
                                                    </div>
                                                    <div class="text">
                                                        <p>Systeme Android</p>
                                                    </div>
                                                </li>
                                                <li th:if="*{autoTransmission}">
                                                    <div class="icon">
                                                        <i class="fa fa-check"></i>
                                                    </div>
                                                    <div class="text">
                                                        <p>Boite automatique</p>
                                                    </div>
                                                </li>
                                            </ul>
                                        </div>
                                        <div class="col-xl-4 col-lg-4 col-md-4">
                                            <ul class="list-unstyled listing-details__features-list">
                                                <li th:if="*{childSeat}">
                                                    <div class="icon">
                                                        <i class="fa fa-check"></i>
                                                    </div>
                                                    <div class="text">
                                                        <p>Siège enfant</p>
                                                    </div>
                                                </li>
                                                <li th:if="*{tintedGlass}">
                                                    <div class="icon">
                                                        <i class="fa fa-check"></i>
                                                    </div>
                                                    <div class="text">
                                                        <p>Verre teinté</p>
                                                    </div>
                                                </li>
                                                <li th:if="*{sunroof}">
                                                    <div class="icon">
                                                        <i class="fa fa-check"></i>
                                                    </div>
                                                    <div class="text">
                                                        <p>Toit ouvrant</p>
                                                    </div>
                                                </li>
                                            </ul>
                                        </div>
                                    </div>
                                </div>
                                <!-- Car additional feautures End -->

                                <!-- Booking form start -->
                                <div class="listing-details__start-booking" id="booking-form">
                                    <h2 class="listing-details__start-booking-title">Reservez votre voiture</h2>

                                    <div class="alert alert-danger py-0 w-50 m-auto text-center mb-3" th:if="${errorMessage}" th:text="${errorMessage}"></div>
                                    <div class="alert alert-danger py-0 w-50 m-auto mb-3" th:if="${bookingStartDateError}" th:text="${bookingStartDateError}"></div>
                                    <div class="alert alert-danger py-0 w-50 m-auto mb-3" th:if="${bookingBackDateError}" th:text="${bookingBackDateError}"></div>

                                    <div class="listing-details__start-booking-wrapper">
                                        <div class="listing-details__start-booking-box tabs-box">
                                            <ul class="tab-btns tab-buttons clearfix list-unstyled">
                                                <li data-tab="#booking" class="tab-btn active-btn"><span>Réservation</span></li>
                                                <li data-tab="#request" class="tab-btn"><span>Autres annonces</span></li>
                                            </ul>
                                            <div class="tabs-content">

                                                <!-- Booking Request form start -->
                                                <div class="tab active-tab" id="booking" th:object="${bookingRequestDto}">
                                                    <div class="listing-details__start-booking-content">

                                                        <form th:action="@{/bookingRequest}" method="post" class="listing-details__start-booking-form-box">
                                                            <ul class="list-unstyled listing-details__start-booking-form clearfix">
                                                                <li class="listing-details__start-booking-input">
                                                                    <!--        <div class="alert alert-danger py-0 w-50 m-auto" th:if="${#fields.hasErrors('bookingStartDate')}" th:errors="*{bookingStartDate}"></div>  -->
                                                                    <input type="text" name="bookingStartDate" placeholder="Select start date" id="datepicker" th:field="*{bookingStartDate}">
                                                                    <div class="listing-details__start-bookin-icon-box">
                                                                        <i class="fa fa-calendar"></i>
                                                                    </div>
                                                                </li>
                                                                <li class="listing-details__start-booking-input">
                                                                    <!--        <div class="alert alert-danger py-0 w-50 m-auto" th:if="${#fields.hasErrors('bookingBackDate')}" th:errors="*{bookingBackDate}"></div>  -->
                                                                    <input type="text" name="bookingBackDate" placeholder="Select back date" id="datepicker2" th:field="*{bookingBackDate}">
                                                                    <div class="listing-details__start-bookin-icon-box">
                                                                        <i class="fa fa-calendar"></i>
                                                                    </div>
                                                                </li>
                                                            </ul>

                                                            <!-- Pour récupérer la page de details en cas d'erreurs -->
                                                            <input type="hidden" name="idCar" th:field="*{idCar}">

                                                            <div class="listing-details__dirver-baby-price-box">
                                                                <div class="listing-details__dirver-baby-price-box-single clearfix">
                                                                    <div class="listing-details__dirver-baby-price-left">
                                                                        <input type="checkbox" name="driver" id="tag_3">
                                                                        <label for="tag_3"><span></span>Chauffeur</label>
                                                                    </div>
                                                                    <div class="listing-details__dirver-baby-price-right">
                                                                        <p>150DH /Jour</p>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                            <div class="listing-details__start-booking-btn-box">
                                                                <button type="submit" class="listing-details__start-booking-btn">Reserver</button>
                                                            </div>
                                                        </form>
                                                    </div>
                                                </div>
                                                <!-- Booking Request form end -->

                                                <!-- Search other listings form start -->
                                                <div class="tab" id="request">
                                                    <div class="listing-details__start-booking-content">
                                                        <form class="listing-details__start-booking-form-box">
                                                            <ul class="list-unstyled listing-details__start-booking-form clearfix">
                                                                <li class="listing-details__start-booking-input">
                                                                    <select class="selectpicker" aria-label="Default select example">
                                                                        <option selected>Pick-up location</option>
                                                                        <option value="1">One</option>
                                                                        <option value="2">Two</option>
                                                                        <option value="3">Three</option>
                                                                    </select>
                                                                </li>
                                                                <li class="listing-details__start-booking-input">
                                                                    <select class="selectpicker" aria-label="Default select example">
                                                                        <option selected>Drop-off location</option>
                                                                        <option value="1">One</option>
                                                                        <option value="2">Two</option>
                                                                        <option value="3">Three</option>
                                                                    </select>
                                                                </li>
                                                                <li class="listing-details__start-booking-input">
                                                                    <select class="selectpicker" aria-label="Default select example">
                                                                        <option selected>Select car class</option>
                                                                        <option value="1">One</option>
                                                                        <option value="2">Two</option>
                                                                        <option value="3">Three</option>
                                                                    </select>
                                                                </li>
                                                                <li class="listing-details__start-booking-input">
                                                                    <input type="text" name="date" placeholder="Select date" id="datepicker2">
                                                                    <div class="listing-details__start-bookin-icon-box">
                                                                        <i class="fa fa-calendar"></i>
                                                                    </div>
                                                                </li>
                                                                <li class="listing-details__start-booking-input">
                                                                    <input type="text" name="time"
                                                                           placeholder="Select time">
                                                                    <div class="listing-details__start-bookin-icon-box">
                                                                        <i class="far fa-clock"></i>
                                                                    </div>
                                                                </li>
                                                                <li class="listing-details__start-booking-input">
                                                                    <select class="selectpicker"
                                                                            aria-label="Default select example">
                                                                        <option selected>Select quantity</option>
                                                                        <option value="1">One</option>
                                                                        <option value="2">Two</option>
                                                                        <option value="3">Three</option>
                                                                    </select>
                                                                </li>
                                                            </ul>
                                                        </form>
                                                        <div class="listing-details__dirver-baby-price-box">
                                                            <div class="listing-details__dirver-baby-price-box-single clearfix">
                                                                <div class="listing-details__dirver-baby-price-left">
                                                                    <input type="checkbox" name="driver" id="tag_1">
                                                                    <label for="tag_1"><span></span>Chauffeur</label>
                                                                </div>
                                                                <div class="listing-details__dirver-baby-price-right">
                                                                    <p>200DH /Jour</p>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div class="listing-details__start-booking-btn-box">
                                                            <button type="submit" class="listing-details__start-booking-btn">Book Rent a Car</button>
                                                        </div>
                                                    </div>
                                                </div>
                                                <!-- Search other listings form end -->

                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <!-- Booking form end -->

                            </div>
                        </div>
                        <!-- Listing details left block End -->

                        <!-- Listing details right block Start -->
                        <div class="col-xl-4 col-lg-5">

                            <div class="listing-details__right">
                                <h3 class="listing-deails__right-title" th:text="*{model.mark.libelle + ' ' + model.libelle}"></h3>

                                <ul class="list-unstyled listing-deails__right-rating">
                                    <li><i class="fa fa-star"></i></li>
                                    <li><i class="fa fa-star"></i></li>
                                    <li><i class="fa fa-star"></i></li>
                                    <li><i class="fa fa-star"></i></li>
                                    <li><i class="fa fa-star"></i></li>
                                </ul>

                                <div class="listing-details__right-price-box">
                                    <div class="listing-details__right-price-icon">
                                        <span>DH</span>
                                    </div>
                                    <div class="listing-details__right-price-text">
                                        <p th:text="*{pricePerDay + '/Jour'}"></p>
                                    </div>
                                </div>

                                <div class="listing-details__contact-info">

                                    <a href="#booking-form" class="listing-details__contact-info-message">
                                        <div class="icon">
                                            <span class="icon-car-rental"></span>
                                        </div>
                                        <div class="text">
                                            <p>Demande Reservation</p>
                                        </div>
                                    </a>

                                    <!-- Cost Button Start -->
                                    <a href="#" class="listing-details__contact-info-message new-cost-btn" data-bs-toggle="modal" data-bs-target="#costModal">
                                        <div class="icon">
                                            <span class="icon-document"></span>
                                        </div>
                                        <div class="text">
                                            <p>Nouvelle charge</p>
                                        </div>
                                    </a>
                                    <!-- Cost Button End -->

                                    <!-- Maintenance Button Start -->
                                    <a href="#" class="listing-details__contact-info-message new-maintenance-btn" data-bs-toggle="modal" data-bs-target="#maintenanceModal">
                                        <div class="icon">
                                            <span class="icon-plumber"></span>
                                        </div>
                                        <div class="text">
                                            <p>Nouvel entretien</p>
                                        </div>
                                    </a>
                                    <!-- Maintenance Button End -->

                                    <!-- Charge Modal Start -->
                                    <div class="modal fade" id="costModal">
                                        <div class="modal-dialog modal-dialog-centered">

                                            <div class="modal-content">

                                                <!-- Modal Header start -->
                                                <div class="modal-header">
                                                    <h4 class="modal-title m-auto text-light">Nouvelle charge</h4>
                                                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                                                </div>
                                                <!-- Modal Header end -->

                                                <!-- Modal body start -->
                                                <div class="p-4">

                                                    <div class="cost-message-error text-danger text-center"></div>

                                                    <div id="modal-cost-form-body">

                                                        <div class="m-3 text-center">
                                                            <div class="form-check form-check-inline">
                                                                <input type="radio" class="form-check-input" id="assurance" name="cost-type" value="ASSURANCE">
                                                                <label class="form-check-label" for="assurance">Assurance</label>
                                                            </div>
                                                            <div class="form-check form-check-inline">
                                                                <input type="radio" class="form-check-input" id="technical-visit" name="cost-type" value="TECHNICAL_VISIT">
                                                                <label class="form-check-label" for="technical-visit">Visite technique</label>
                                                            </div>
                                                            <div class="form-check form-check-inline">
                                                                <input type="radio" class="form-check-input" id="car-sticker" name="cost-type" value="CAR_STICKER">
                                                                <label class="form-check-label" for="car-sticker">Vignette</label>
                                                            </div>
                                                        </div>

                                                        <div class="search-box__input mb-4 new-date m-auto shadow">
                                                            <input type="text" class="mb-4" name="cost-date" placeholder="Date d'échéance" id="datepicker1">
                                                            <div class="search-box__icon-box">
                                                                <i class="fa fa-calendar"></i>
                                                            </div>
                                                        </div>

                                                        <div class="form-floating search-box__input mb-4 new-amount m-auto shadow">
                                                            <input type="number" id="cost-amount" class="form-control px-4" min="0" name="cost-amount" required>
                                                            <label for="cost-amount" class="text-dark px-4">Montant</label>
                                                        </div>
                                                    </div>

                                                    <div id="modal-cost-result-body" class="d-none text-center modal-cost-result-body">
                                                        <h4 class="message-success text-success text-center mb-4"></h4>
                                                        <ul class="modal-list">
                                                            <li>Type  :  <span id="cost-result-type"></span></li>
                                                            <li>Date d'écheance  :  <span id="cost-result-due-date"></span></li>
                                                            <li>Montant  :  <span id="cost-result-amount"></span></li>
                                                        </ul>
                                                    </div>
                                                </div>
                                                <!-- Modal body end -->

                                                <!-- Modal footer start -->
                                                <div class="modal-footer justify-content-center">
                                                    <button type="button" class="btn btn-add cost-btn-add rounded-pill" th:id="*{id}">Ajouter</button>
                                                    <button type="button" class="btn btn-exit rounded-pill" data-bs-dismiss="modal">Fermer</button>
                                                </div>
                                                <!-- Modal footer end -->

                                            </div>

                                        </div>
                                    </div>
                                    <!-- Cost Modal End -->

                                    <!-- Maintenance Modal Start -->
                                    <div class="modal fade" id="maintenanceModal">
                                        <div class="modal-dialog modal-dialog-centered">

                                            <div class="modal-content">

                                                <!-- Modal Header start -->
                                                <div class="modal-header">
                                                    <h4 class="modal-title m-auto text-light">Nouvel entretien</h4>
                                                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                                                </div>
                                                <!-- Modal Header end -->

                                                <!-- Modal body start -->
                                                <div class="p-4">

                                                    <div class="maintenance-message-error text-danger text-center"></div>

                                                    <div id="modal-maintenance-form-body">
                                                        <div class="mb-2 text-center">
                                                            <div class="form-check form-check-inline">
                                                                <input class="form-check-input" type="radio" id="car-repair" name="maintenance-type" value="CAR_REPAIR" checked>
                                                                <label class="form-check-label" for="car-repair">Reparation</label>
                                                            </div>
                                                            <div class="form-check form-check-inline">
                                                                <input class="form-check-input" type="radio" id="oil-change" name="maintenance-type" value="OIL_CHANGE">
                                                                <label class="form-check-label" for="oil-change">Vidange</label>
                                                            </div>
                                                        </div>

                                                        <div class="search-box__input mb-2 new-date m-auto shadow">
                                                            <input type="text" class="mb-4" name="maintenance-date" placeholder="Date d'effet" id="datepicker3">
                                                            <div class="search-box__icon-box">
                                                                <i class="fa fa-calendar"></i>
                                                            </div>
                                                        </div>

                                                        <div class="form-floating search-box__input mb-2 new-amount m-auto shadow">
                                                            <input type="number" id="maintenance-amount" class="form-control px-4" min="0" name="maintenance-amount">
                                                            <label for="maintenance-amount" class="text-dark px-4">Montant</label>
                                                        </div>

                                                        <div class="form-floating search-box__input mb-2 maintenance-max-mileage m-auto shadow">
                                                            <input type="number" id="maintenance-max-mileage" class="form-control px-4" min="0" name="maintenance-max-mileage">
                                                            <label for="maintenance-max-mileage" class="text-dark px-4">Kilometrage maximal</label>
                                                        </div>

                                                        <div class="form-group m-auto maintenance-comment-block">
                                                            <textarea class="form-control" rows="5" id="maintenance-comment" placeholder="Description"></textarea>
                                                        </div>

                                                    </div>

                                                    <div id="modal-maintenance-result-body" class="d-none text-center modal-maintenance-result-body">
                                                        <h4 class="message-success text-success text-center mb-4"></h4>
                                                        <ul class="modal-list">
                                                            <li>Type  :  <span id="maintenance-result-type"></span></li>
                                                            <li>Montant  :  <span id="maintenance-result-amount"></span></li>
                                                            <li class="maintenance-result-max-mileage">Kilometrage maximal  :  <span id="maintenance-result-max-mileage"></span></li>
                                                            <li>Date  :  <span id="maintenance-result-date"></span></li>
                                                            <li class="maintenance-result-comment">Description  :  <span id="maintenance-result-comment"></span></li>
                                                        </ul>
                                                    </div>
                                                </div>
                                                <!-- Modal body end -->

                                                <!-- Modal footer start -->
                                                <div class="modal-footer justify-content-center">
                                                    <button type="button" class="btn btn-add maintenance-btn-add rounded-pill" th:id="*{id}">Ajouter</button>
                                                    <button type="button" class="btn btn-exit rounded-pill" data-bs-dismiss="modal">Fermer</button>
                                                </div>
                                                <!-- Modal footer end -->

                                            </div>

                                        </div>
                                    </div>
                                    <!-- Maintenance Modal End -->
                                </div>
                            </div>

                            <div class="listing-details__share-report-favorite-btn">
                                <a href="#"><i class="fas fa-edit"></i>Modifier</a>
                                <a href="#"><i class="fas fa-share"></i>Partager</a>
                                <a href="#"><i class="fas fa-flag"></i>Rapport</a>
                            </div>

                            <!-- Features box start -->
                            <div class="listing-details__features-box">
                                <div class="listing-details__features-box-single">
                                    <div class="listing-details__features-box-left">
                                        <p>Réservations en cours:</p>
                                    </div>
                                    <div class="listing-details__features-box-right">
                                        <span th:text="*{numberOfBookingsInProgress}"></span>
                                    </div>
                                </div>
                                <div class="listing-details__features-box-single">
                                    <div class="listing-details__features-box-left">
                                        <p>Assurance:</p>
                                    </div>
                                    <div class="listing-details__features-box-right">
                                        <span id="assurance-due-date" th:text="${carDetailsDto.assurance.dueDate} ? ${#temporals.format(carDetailsDto.assurance.dueDate, 'dd/MM/yyyy')}"></span>
                                    </div>
                                </div>
                                <div class="listing-details__features-box-single">
                                    <div class="listing-details__features-box-left">
                                        <p>Visite Technique:</p>
                                    </div>
                                    <div class="listing-details__features-box-right">
                                        <span id="technical-visit-due-date" th:text="${carDetailsDto.technicalVisit.dueDate} ? ${#temporals.format(carDetailsDto.technicalVisit.dueDate, 'dd/MM/yyyy')}"></span>
                                    </div>
                                </div>
                                <div class="listing-details__features-box-single">
                                    <div class="listing-details__features-box-left">
                                        <p>Vignette:</p>
                                    </div>
                                    <div class="listing-details__features-box-right">
                                        <span id="car-sticker-due-date" th:text="${carDetailsDto.carSticker.dueDate} ? ${#temporals.format(carDetailsDto.carSticker.dueDate, 'dd/MM/yyyy')}"></span>
                                    </div>
                                </div>
                                <div class="listing-details__features-box-single">
                                    <div class="listing-details__features-box-left">
                                        <p>Kilometrage de vidange:</p>
                                    </div>
                                    <div class="listing-details__features-box-right">
                                        <span id="oil-change-max-mileage" th:text="*{oilChange.maxMileage}"></span>
                                    </div>
                                </div>
                                <div class="listing-details__features-box-single">
                                    <div class="listing-details__features-box-left">
                                        <p>Nombre de visites:</p>
                                    </div>
                                    <div class="listing-details__features-box-right">
                                        <span th:text="*{numberOfVisits}"></span>
                                    </div>
                                </div>
                                <div class="listing-details__features-box-single">
                                    <div class="listing-details__features-box-left">
                                        <p>Dernière visite:</p>
                                    </div>
                                    <div class="listing-details__features-box-right">
                                        <span th:text="${#temporals.format(carDetailsDto.lastVisitDateTime, 'HH:mm:ss dd/MM/yyyy')}"></span>
                                    </div>
                                </div>
                                <div class="listing-details__features-box-single">
                                    <div class="listing-details__features-box-left">
                                        <p>Année:</p>
                                    </div>
                                    <div class="listing-details__features-box-right">
                                        <span th:text="${#temporals.format(carDetailsDto.dateCirculation, 'dd/MM/yyyy')}"></span>
                                    </div>
                                </div>
                                <div class="listing-details__features-box-single">
                                    <div class="listing-details__features-box-left">
                                        <p>Type de carburant:</p>
                                    </div>
                                    <div class="listing-details__features-box-right">
                                        <span th:text="*{fuel.libelle}"></span>
                                    </div>
                                </div>
                                <div class="listing-details__features-box-single">
                                    <div class="listing-details__features-box-left">
                                        <p>Nombre de places:</p>
                                    </div>
                                    <div class="listing-details__features-box-right">
                                        <span th:text="*{numberOfPlaces}"></span>
                                    </div>
                                </div>
                                <div class="listing-details__features-box-single">
                                    <div class="listing-details__features-box-left">
                                        <p>Nombre de portes:</p>
                                    </div>
                                    <div class="listing-details__features-box-right">
                                        <span th:text="*{numberOfDoors}"></span>
                                    </div>
                                </div>
                                <div class="listing-details__features-box-single">
                                    <div class="listing-details__features-box-left">
                                        <p>Color:</p>
                                    </div>
                                    <div class="listing-details__features-box-right">
                                        <span th:style="${'background-color:' + carDetailsDto.color + '; color: ' + carDetailsDto.color}">Lorem</span>
                                    </div>
                                </div>
                            </div>
                            <!-- Features box end -->

                            <!-- Calendar start -->
                            <div class="listing-details__calendar">
                                <div id="datepicker-inline"></div><!-- /#datepicker-inline -->
                            </div>
                            <!-- Calendar end -->

                        </div>
                        <!-- Listing details right block End -->

                    </div>
                </div>
            </section>
            <!--Listing Details End-->

        </section>
        <!-- Dynamic Content Section End -->

    </body>
</html>